<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="httpfs-entry" attributes="url basedir name mtime size directory">
    <template>
    <link rel="stylesheet" href="httpfs-entry.css">
    <div id="preview">
    </div>
    <div id="info">
        <a href='#{{basedir}}{{name}}{{directory ? "/" : ""}}'>{{name}}{{directory ? "/" : ""}}</a> -
        {{mtime}} -
        {{size}}
    </div>
    </template>
    <script>

        var extensionInfo = {
            "jpg": {
                contentType: "image/jpeg",
                image: true
            },
            "jpeg": {
                contentType: "image/jpeg",
                image: true
            },
            "png": {
                contentType: "image/png",
                image: true
            },
            "gif": {
                contentType: "image/gif",
                image: true
            },
            "webp": {
                contentType: "image/webp",
                image: true
            },
            "mp4": {
                contentType: "video/mp4",
                video: true
            },
            "webm": {
                contentType: "video/webm",
                video: true
            }
        };

        Polymer("httpfs-entry", {
            attached: function () {
                if (!this.name || this.directory){
                    return;
                }

                var dotIndex = this.name.lastIndexOf(".");
                if (dotIndex < 0) {
                    return;
                }

                var extension = this.name.substring(dotIndex + 1, this.name.length);
                extension = extension.trim().toLowerCase();

                var info = extensionInfo[extension];
                if (!info || !info.image) {
                    return;
                }

                var path = this.basedir + this.name,
                    encodedPath = encodeURIComponent(path).replace(/\%20/g, "+"),
                    href = this.url + "/read?path=" + encodedPath + "&preview=1";

                if (window.devicePixelRatio === 2) {
                    href += "&retina=1";
                }

                var imgHtml = "<img src='" + href + "'/>";
                this.$.preview.innerHTML = imgHtml;
            }
        });
    </script>
</polymer-element>
